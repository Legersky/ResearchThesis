Unfortunately, the extending window method does not always converge. The algorithm may lead to an infinite loop in both phases. 
In this chapter, we introduce a sufficient condition for convergence of Phase 1 in Theorem \ref{thm:suffCondPhase1} and we categorize the algebraic number $\omega$ according to this condition. Theorem \ref{thm:stoppingCondition} enables us to construct an algorithm which checks the necessary condition for convergence of Phase 2.

% However,  and Theorem \ref{thm:stoppingCondition} enables us to construct Algorithm \ref{alg:oneletterSets} which checks the necessary condition for convergence of Phase 2.  

\section{Convergence of Phase 1}
\label{sec:convergencePhase1}
The following theorem gives the condition on $\omega$ which is sufficient for convergence of the Phase 1.
\begin{theo}
\label{thm:suffCondPhase1}
    Let $\omega$ be an algebraic integer. Let $\A$ and $\B$ be finite subsets of $\Zomega$ such that $\A$ contains at least one representative of each congruence class modulo $\beta$ in $\Zomega$. Then, there exists a set $\Q\subset\Zomega$ such that $ \B + \Q \subset \A + \beta \Q$ and all elements of $\Q$ are limited by constant $R\in \RR^+$ in modulus.
    
    Moreover, if $\omega$ is such that any complex circle centered at 0 contains only finitely  many elements of $\Zomega$, the set $\Q$ is finite. 
\end{theo}
\begin{proof}
 Denote $A:=\max\{|a|\colon a \in \A\}$ and $B:=\max\{|b|\colon b\in\B\}$. Consequently, set $R:=\frac{A+B}{|\beta|-1}$ and $\Q:=\{q\in\Zomega\colon |q|\leq R\}$. Since $A>0$ and $|\beta|>1$, the set $\Q$ is not empty. Any element $x=b+q \in \Zomega$ with $b\in\B$ and $q\in\Q$ can be written as $x=a+\beta q'$ for some $a\in\A$ due to existence of representative of each congruence class in $\A$. We prove that $|q'|\leq R$:
 $$
    |q'|=\frac{|b+q-a|}{|\beta|}\leq \frac{B+R+A}{|\beta|} \leq \frac{1}{|\beta|}\left(A+B+\frac{A+B}{|\beta|-1}\right)  =\frac{A+B}{|\beta|}\left(\frac{|\beta|}{|\beta|-1}\right)=R\,.
 $$ 
 Hence $q'\in\Q$ and thus  $x=b+q \in \A + \beta \Q$. 
 
 Obviously, the set $\Q$ is finite if there are only finitely many elements of $\Zomega$ bounded by the constant $R$.
\end{proof}
We plug in the alphabet $\A$ and input alphabet $\B$. Because of adding of the smallest elements in Algorithm \ref{alg:extendWeightCoefSet}, we see from the proof of Theorem \ref{thm:suffCondPhase1} that the weight coefficient set~$\Q$ constructed in Phase~1 has elements bounded by the constant $R$. 

Therefore, the intermediate weight coefficient sets $\Q_k$ in Algorithm \ref{alg:weightCoefSet} have elements bounded by $R$ for all $k\in\NN$. Hence, Phase 1 succesfully ends if there are only finitely many elements in $\Zomega$ bounded by the constant $R$. 


The following two lemmas characterizes the algebraic integer $\omega$ according to the number of elements of $\Zomega$ in a complex circle centered around 0. 
\begin{lem}
\label{lem:numElemRR}
Let $\omega\in\RR$ be an algebraic integer and $R$ be a positive constant. There are only finitely many elements in the set $\left\{x \in\Zomega \colon |x|<R \right\}$ if and only if $\omega \in \ZZ$. 
\end{lem}
\begin{proof}
If $\omega \in \ZZ$, then $\Zomega = \ZZ$. Trivially, there are only finitely many integers bounded by any constant $R$.

Suppose now that $\omega \notin \ZZ$ and we show that 
$$
(\forall R>0) (\exists_\infty x\in \Zomega)(|x|<R)\,.
$$ 

The degree of $\omega$ is at least two as the only algebraic integers of degree one are integers, i.e. $\omega \in \RR \setminus \QQ$. 
Set $x:= \omega- \lfloor \omega \rfloor$. We see that $0<x<1$ as $\omega \notin \ZZ$ and $x \in \Zomega$ as $\omega \in \Zomega$, $\lfloor \omega \rfloor \in  \ZZ\subset\Zomega$ and $\Zomega$ is a ring. 
Hence, the sequence $(x^n)_{n\in \NN}$ is strictly decreasing and its limit is 0 which implies the claim.
\end{proof}


\begin{lem}
\label{lem:numElemCC}
Let $\omega\in \CC\setminus\RR$ be an algebraic integer and $R$ be a positive constant. There are only finitely many elements in the set $\left\{x \in\Zomega \colon |x|<R\right\}$ if and only if the degree of $\omega$ is two.  
\end{lem}
\begin{proof}
If the degree of $\omega$ is two, the set $\Zomega$ is generated by integer combinations of 1 and $\omega$, i.e. it is the lattice in $\CC$. Thus the number of elements of the set $\left\{x \in\Zomega \colon |x|<R\right\}$ is finite.

Suppose now that the degree of $\omega$ is at least three as there are no complex algebraic integers with the degree one. 


We recall that for all $r,s\in\RR\setminus\{0\}, |r|\leq|s|$, there exists $k\in\ZZ\setminus\{0\}$ such that $|k\cdot r -s|\leq |r|/2$. It follows from the fact that $l\cdot |r| \leq |s| <(l+1)|r| $ for some $l\in\ZZ\setminus\{0\}$. We choose $k$ from $\{\pm l,\pm(l+1)\}$ accordingly. 
 
Now, if $|\Im \omega|\leq|\Im \omega^2|$, set $z_0:=\omega$ and $w:=\omega^2$. Otherwise, set $z_0:=\omega^2$ and $w:=\omega$.   

We build the sequence $(z_i)_{i\in\NN}$ recurrently:
$$
z_{i+1}:=k_{i+1} \cdot z_{i}-w\, 
$$
where $k_{i+1}\in\ZZ$ is such that 
$$
|\Im z_{i+1}|=|k_{i+1} \cdot\Im z_{i}-\Im w|\leq \frac{|\Im z_{i}|}{2}\,.
$$
We can find such number $k_{i+1}$ under assumption that $\Im z_{i} \neq 0$.

We prove by induction that $|\Im z_i|\leq |\Im z_0|/2^i$. Clearly, it holds for $i=0$. Assume now that it holds for $i$. Then 
$$
|\Im z_{i+1}|= |k_{i+1} \cdot \Im z_{i}- \Im w|\leq \frac{1}{2}|\Im z_i|\leq \frac{|\Im z_0|}{2^{i+1}}\,. 
$$
Hence, $k_i\neq 0$ for all $i\in\NN$ as $|\Im z_i|\leq |\Im z_0|/2^i \leq |\Im w|$.

Next, we show that
$$
z_i=z_0 \cdot \prod_{j=1}^i k_j- l_i\cdot w
$$
for some $l_i\in\ZZ$. 

Obviously, $z_0=z_0 \prod_{j=1}^0 k_j - 0\cdot w$. Assume now that it holds for $i$ and consider
$$
z_{i+1}=k_{i+1} \cdot z_{i}-w= k_{i+1}\left(z_0 \cdot \prod_{j=1}^i k_j- l_i\cdot w\right) -w=z_0 \cdot \prod_{j=1}^{i+1} k_j - (\underbrace{k_{i+1}\cdot l_i +1}_{=:l_{i+1}})w\,.
$$
Thus, $z_i\in\Zomega$. Moreover, $z_i\notin \ZZ$. Assume in contrary that 
$$
z_0 \cdot \prod_{j=1}^i \underbrace{k_j}_{\neq0}- l_i\cdot w = z_i\in \ZZ\,.
$$
Since $z_0,w\in\{\omega, \omega^2\}, z_0\neq w$, we have the integer polynomial of degree two with zero $\omega$. It contradicts that the degree of $\omega$ is at least three.
% Then $z_{i+1}\in\Zomega$ as $z_{i+1}=k_{i+1} \cdot z_{i}-w$ which is an integer combination of numbers from $\Zomega$. Also,



Now we take $i_0\in\NN$ such that $|\Im z_0|/2^{i_0}< 1/2$. Let $k\in\ZZ$ be such that $|\Re z_{i_0} -k|\leq 1/2$. Set $x:= z_{i_0}-k$. Then
$$
|x|\leq |\Re x| +|\Im x| \leq  |\Re z_{i_0} -k| + |\Im z_{i_0}| \leq \frac{1}{2} + \frac{|\Im z_0|}{2^{i_0}} < \frac{1}{2} +\frac{1}{2}=1\,.
$$
We know that $\Im z_{i_0} \neq 0$ and thus $0<|x|<1$.

Consider now the case that we cannot produce $z_{i_1+1}$  in the sequence $(z_i)_{i\in\NN}$ as there is ${i_1}$ such that $\Im z_{i_1} = 0$, i.e. $z_{i_1}\in\RR$. In the same manner as before, we may prove that  $z_{i_1} \in \Zomega\setminus \ZZ$. Set $x:= z_{i_1}- \lfloor z_{i_1} \rfloor$. Obviously, $0<|x|<1$ and $x\in\Zomega$.

For both cases, the sequence $(x^n)_{n\in\NN}$ has the limit 0 and $0\neq x^n\in\Zomega$ for all $n\in\NN$. Thus there are infinitely many elements of $\Zomega$ bounded by any positive constant $R$. 
\end{proof}


Using Theorem \ref{thm:suffCondPhase1} and Lemma \ref{lem:numElemRR} and \ref{lem:numElemCC}, we categorize an algebraic integer $\omega$ which generates $\Zomega \ni \beta$ as follows:

\begin{itemize}
    \item $\omega \in \ZZ \implies$ Phase~1 converges.
    \item $\omega \in \RR\setminus\ZZ$ -- the sufficient condition does not hold and we we have an example for which Phase 1 does not converge (see Section \ref{sec:example_nonoconvergence_phase1}).
    \item $\omega \in \CC\setminus\RR$, $\omega$ being quadratic algebraic integer $\implies$ Phase~1 converges.
    \item $\omega \in \CC\setminus\RR$, $\omega$ being algebraic integer of degree $\geq 3$ -- the sufficient condition does not hold  and therefore the convergence of Phase~1 is not guaranteed.
\end{itemize}

\section{Convergence of Phase 2}
\label{sec:convergencePhase2}
For shorter notation, set 
$$
\Qb{m}:=\Q_{[\underbrace{\scriptstyle b,\dots,b}_m]}
$$ for $m \in \NN$ and $b\in\B$.

Obviously, finitness of Phase~2 implies that there exists a length of window $M$ such that the set $\Qb{m}$ contains only one element for all $b\in\B$. 
The following theorem is used for the construction of algorithm which checks this necessary condition. 

\begin{theo}
\label{thm:stoppingCondition}
Let $m_0 \in \NN$ and $b\in\B$ be such that sets $\Qb{m_0}$ and $\Qb{m_0-1}$ produced by Algorithm \ref{alg:minimalSet} within Phase~2 have the same size. Then
$$
    \#\Qb{m} = \#\Qb{m_0} \qquad \forall m\geq m_0-1\,.
$$ 
Particularly, if $\#\Qb{m_0}\geq 2$, Phase~2 does not converge.
\end{theo}
\begin{proof}
We prove the base case of induction with respect to $m$. For $m=m_0+1$, the set $\Qb{m_0+1}$ is found by Algorithm \ref{alg:minimalSet} such that 
$$
b + \Qb{m_0} \subset \A + \beta \Qb{m_0+1}\,
$$
and set $\Qb{m_0}$ is found by the same algorithm such that
$$
b + \Qb{m_0-1} \subset \A + \beta \Qb{m_0}\,.
$$
As $\Qb{m_0} \subset \Qb{m_0-1}$, the assumption of the same size implies
$$
    \Qb{m_0} = \Qb{m_0-1}\,.
$$
It means that Algorithm \ref{alg:minimalSet} runs with the same input and hence
$$
\Qb{m_0+1}=\Qb{m_0}\,.
$$
The inductive step of the proof for $m+1$ is analogous to the base case.

Phase 2 ends when there is only one element in $\Q_{[w_j,\dots, w_{j-m+1}]}$ for all $(w_j,\dots, w_{j-m+1}) \in \B^m$ for some fixed length of window $m$. But if $\#\Qb{m_0}\geq 2$, size of $\Q_{[b,\dots,b]}$ does not decrease despite of extending the length of window.
\end{proof}



\begin{algorithm}
  \caption{Check input $bb\dots b$}
    \label{alg:oneletterSets}
  \begin{algorithmic}[1]
    \REQUIRE{Weight coefficient set $\Q$, digit $b\in\B$}
    \STATE $m:=1$
    \STATE Find minimal set $\Qb{1} \subset \Q$ such that
      $$
      b + \Q \subset \A + \beta \Qb{1}\,.
      $$
      \vspace{-20pt}
    \WHILE{$\#\Qb{m} > 1$}
        \STATE $m:= m +1$
        \STATE By Algorithm \ref{alg:minimalSet}, find minimal set $\Qb{m} \subset \Qb{m-1}$ such that
          $$
          b + \Qb{m-1} \subset \A + \beta \Qb{m}\,.
          $$  
          \vspace{-20pt}
        \IF{$\#\Qb{m}=\#\Qb{m-1}$}
            \RETURN Phase 2 does not converge for input $bb\dots b$.
        \ENDIF
    \ENDWHILE  
    \RETURN Weight coefficient for input $bb\dots b$ is the only element of $\Qb{m}$.
  \end{algorithmic}
\end{algorithm}

For arbitrary $m$, sets $\Qb{m}$  can be easily constructed separately for each $b\in\B$. Using Theorem \ref{thm:stoppingCondition}, Algorithm \ref{alg:oneletterSets} checks whether Phase~2 stops processing input digits $bb\dots b$. Thus,  non-finiteness of Phase~2 can be revealed by running it for each input digit $b\in\B$.
