Unfortunately, the extending window method does not always converge. The algorithm may lead to an infinite loop in both phases. 
In this chapter, we introduce a sufficient condition for convergence of Phase 1 in Theorem \ref{thm:suffCondPhase1} and we categorize the algebraic numbers $\omega$ according to this condition. Theorem \ref{thm:stoppingCondition} enables us to construct an algorithm which checks a necessary condition for convergence of Phase 2. At the end, we recall conditions on the alphabet $\A$. 

\section{Convergence of Phase 1}
\label{sec:convergencePhase1}
The following lemma is necessary for the proof of Theorem \ref{thm:suffCondPhase1} which gives a sufficient condition of convergence of Phase 1.
\begin{lem}
\label{lem:suffCondPhase1}
    Let $\omega$ be an algebraic integer. Let $\A$ and $\B$ be finite subsets of $\Zomega$ such that $\A$ contains at least one representative of each congruence class modulo $\beta$ in $\Zomega$. Then there exists a set $\Q\subset\Zomega$ and constant $R\in \RR^+$ such that $ \B + \Q \subset \A + \beta \Q$ and all elements of $\Q$ are limited by the constant $R$ in modulus.
    
    Moreover, if $\omega$ is such that any complex circle centered at 0 contains only finitely  many elements of $\Zomega$, the set $\Q$ is finite. 

\end{lem}

\begin{proof}
 Denote $A:=\max\{|a|\colon a \in \A\}$ and $B:=\max\{|b|\colon b\in\B\}$. Consequently, set $R:=\frac{A+B}{|\beta|-1}$ and $\Q:=\{q\in\Zomega\colon |q|\leq R\}$. Since $A>0$ and $|\beta|>1$, the set $\Q$ is not empty. Any element $x=b+q \in \Zomega$ with $b\in\B$ and $q\in\Q$ can be written as $x=a+\beta q'$ for some $a\in\A$  and $q'\in\Zomega$ due to existence of a representative of each congruence class in $\A$. We prove that $|q'|\leq R$:
 $$
    |q'|=\frac{|b+q-a|}{|\beta|}\leq \frac{B+R+A}{|\beta|} \leq \frac{1}{|\beta|}\left(A+B+\frac{A+B}{|\beta|-1}\right)  =\frac{A+B}{|\beta|}\left(\frac{|\beta|}{|\beta|-1}\right)=R\,.
 $$ 
 Hence $q'\in\Q$ and thus  $x=b+q \in \A + \beta \Q$. 
 
 Obviously, the set $\Q$ is finite if there are only finitely many elements of $\Zomega$ bounded by the constant $R$.
\end{proof}

\begin{theo}
\label{thm:suffCondPhase1}
Let $\omega$ be an algebraic integer. Let the alphabet $\A\subset\Zomega$ be such that $\A$ contains at least one representative of each congruence class modulo $\beta$ in $\Zomega$. Let $\B\subset\Zomega$ be the input alphabet. 

If $\omega$ is such that any complex circle centered at 0 contains only finitely  many elements of $\Zomega$, Phase 1 of the extending window method converges.
\end{theo}
\begin{proof}
We have the constant $R$ and finite set $\Q$ from Lemma \ref{lem:suffCondPhase1} for the alphabet $\A$ and input alphabet $\B$. We prove by induction that  all intermediate weight coefficient sets $\Q_k$ in Algorithm \ref{alg:weightCoefSet} are subsets of the finite set $\Q$. 

We start with $\Q_0=\{0\}$ which is bounded by any positive constant. Suppose that the intermediate weight coefficients set $\Q_k$ has elements bounded by the constant $R$. We see from the previous  proof that the candidates obtained by Algorithm \ref{alg:searchCand} for the set $\Q_k$ are also bounded by $R$. Thus, the next intermediate weight coefficients set $\Q_{k+1}$ has elements bounded by the constant $R$, i.e., $\Q_{k+1}\subset\Q$. 

Since $\#\Q$ is finite and $\Q_0\subset\Q_1\subset\Q_2\subset\cdots$,  Phase 1 successfully ends. 
\end{proof}



The following two lemmas characterize algebraic integers $\omega$ according to the number of elements of $\Zomega$ in a complex circle centered around 0. The first lemma deals with real numbers and the second with non-real.
\begin{lem}
\label{lem:numElemRR}
Let $\omega\in\RR$ be an algebraic integer and $R$ be a positive constant. There are only finitely many elements in the set $\left\{x \in\Zomega \colon |x|<R \right\}$ if and only if $\omega \in \ZZ$. 
\end{lem}
\begin{proof}
If $\omega \in \ZZ$, then $\Zomega = \ZZ$. Trivially, there are only finitely many integers bounded by any constant $R$.

Suppose now that $\omega \notin \ZZ$. We show that 
$$
(\forall R>0) (\exists_\infty x\in \Zomega)(|x|<R)\,.
$$ 

The degree of $\omega$ is at least two as the only algebraic integers of degree one are integers, i.e. $\omega \in \RR \setminus \QQ$. 
Set $x:= \omega- \lfloor \omega \rfloor$. We see that $0<x<1$ as $\omega \notin \ZZ$ and $x \in \Zomega$ as $\omega \in \Zomega$, $\lfloor \omega \rfloor \in  \ZZ\subset\Zomega$ and $\Zomega$ is a ring. 
Hence, the sequence $(x^n)_{n\in \NN}$ is strictly decreasing and its limit is 0 which implies the claim.
\end{proof}


\begin{lem}
\label{lem:numElemCC}
Let $\omega\in \CC\setminus\RR$ be an algebraic integer and $R$ be a positive constant. There are only finitely many elements in the set $\left\{x \in\Zomega \colon |x|<R\right\}$ if and only if the degree of $\omega$ is two.  
\end{lem}
\begin{proof}
If the degree of $\omega$ is two, the set $\Zomega$ is generated by integer combinations of 1 and $\omega$, i.e. it is a lattice in $\CC$. Thus the number of elements of the set $\left\{x \in\Zomega \colon |x|<R\right\}$ is finite.

Suppose now that the degree of $\omega$ is at least three as there are no complex algebraic integers of degree one. 


We recall that for all $r,s\in\RR\setminus\{0\}, |r|\leq|s|$, there exists $k\in\ZZ\setminus\{0\}$ such that $|k\cdot r -s|\leq |r|/2$. It follows from the fact that $l\cdot |r| \leq |s| <(l+1)|r| $ for some $l\in\ZZ\setminus\{0\}$. We choose $k$ from $\{\pm l,\pm(l+1)\}$ accordingly. 
 
Now, if $|\Im \omega|\leq|\Im \omega^2|$, set $z_0:=\omega$ and $w:=\omega^2$. Otherwise, set $z_0:=\omega^2$ and $w:=\omega$.   

We build the sequence $(z_i)_{i\in\NN}$ recurrently:
$$
z_{i+1}:=k_{i+1} \cdot z_{i}-w\, 
$$
where $k_{i+1}\in\ZZ$ is such that 
$$
|\Im z_{i+1}|=|k_{i+1} \cdot\Im z_{i}-\Im w|\leq \frac{|\Im z_{i}|}{2}\,.
$$
First, suppose that $\Im z_{i} \neq 0$ for all $i\in\NN$. Therefore, we can build the whole sequence~$(z_i)_{i\in\NN}$.

We prove by induction that $|\Im z_i|\leq |\Im z_0|/2^i$. Clearly, it holds for $i=0$. Assume now that it holds for $i$. Then 
$$
|\Im z_{i+1}|= |k_{i+1} \cdot \Im z_{i}- \Im w|\leq \frac{1}{2}|\Im z_i|\leq \frac{|\Im z_0|}{2^{i+1}}\,. 
$$
Hence, $k_i\neq 0$ for all $i\in\NN$ as $|\Im z_i|\leq |\Im z_0|/2^i \leq |\Im w|$.

Next, we show that
$$
z_i=z_0 \cdot \prod_{j=1}^i k_j- l_i\cdot w
$$
for some $l_i\in\ZZ$. 

Obviously, $z_0=z_0 \prod_{j=1}^0 k_j - 0\cdot w$. Assume now that it holds for $i$ and consider
$$
z_{i+1}=k_{i+1} \cdot z_{i}-w= k_{i+1}\left(z_0 \cdot \prod_{j=1}^i k_j- l_i\cdot w\right) -w=z_0 \cdot \prod_{j=1}^{i+1} k_j - (\underbrace{k_{i+1}\cdot l_i +1}_{=:l_{i+1}\in\ZZ})w\,.
$$
Thus, $z_i\in\Zomega$. Moreover, $z_i\notin \ZZ$. Assume in contrary that 
$$
z_0 \cdot \underbrace{\prod_{j=1}^i \underbrace{k_j}_{\neq0}}_{\in\ZZ}- \underbrace{l_i}_{\in\ZZ}\cdot w = z_i\in \ZZ\,.
$$
Since $z_0,w\in\{\omega, \omega^2\}, z_0\neq w$, we have an integer polynomial of degree $2$ having $\omega$ as a root. It contradicts that the degree of $\omega$ is at least three.
% Then $z_{i+1}\in\Zomega$ as $z_{i+1}=k_{i+1} \cdot z_{i}-w$ which is an integer combination of numbers from $\Zomega$. Also,



Suppose $i_0\in\NN$ such that $|\Im z_0|/2^{i_0}< 1/2$. Let $k\in\ZZ$ be such that $|\Re z_{i_0} -k|\leq 1/2$. Set $x:= z_{i_0}-k$. Then
$$
|x|\leq |\Re x| +|\Im x| \leq  |\Re z_{i_0} -k| + |\Im z_{i_0}| \leq \frac{1}{2} + \frac{|\Im z_0|}{2^{i_0}} < \frac{1}{2} +\frac{1}{2}=1\,.
$$
We know that $\Im z_{i_0} \neq 0$ and thus $0<|x|<1$.

Consider now the case that there is ${i_1}$ such that $\Im z_{i_1} = 0$, i.e. $z_{i_1}\in\RR$, and $i_1$ is the least number with this property. Thus, we cannot produce $z_{i_1+1}$  in the sequence $(z_i)_{i\in\NN}$. In the same manner as before, we may prove that  $z_{i_1} \in \Zomega\setminus \ZZ$. Set $x:= z_{i_1}- \lfloor z_{i_1} \rfloor$. Obviously, $0<|x|<1$ and $x\in\Zomega$.

For both cases, the sequence $(x^n)_{n\in\NN}$ has the limit 0 and $0\neq x^n\in\Zomega$ for all $n\in\NN$. Thus there are infinitely many elements of $\Zomega$ bounded by any positive constant $R$. 
\end{proof}


Using Theorem \ref{thm:suffCondPhase1} and Lemma \ref{lem:numElemRR} and \ref{lem:numElemCC}, we categorize an algebraic integer $\omega$ which generates $\Zomega \ni \beta$ as follows:

\begin{itemize}
    \item $\omega \in \ZZ \implies$ Phase~1 converges.
    \item $\omega \in \RR\setminus\ZZ \implies$ the sufficient condition of Theorem \ref{thm:suffCondPhase1} does not hold and there is  Example \ref{ex:Quadratic+1-5+31-blockinteger} for which Phase 1 does not converge.  Example \ref{ex:Quadratic+1-5+51-blockreal} proves that the condition is not necessary.
    \item $\omega \in \CC\setminus\RR$, $\omega$ being quadratic algebraic integer $\implies$ Phase~1 converges.
    \item $\omega \in \CC\setminus\RR$, $\omega$ being algebraic integer of degree $\geq 3 \implies$ the sufficient condition  of Theorem \ref{thm:suffCondPhase1} does not hold and there is  Example \ref{ex:Cubic+1+1-1+1complex} for which Phase 1 does not converge. Example \ref{ex:Cubic+1+1-5+5complex} proves that the condition is not necessary.
\end{itemize}
We see that if the sufficient condition does not hold, convergence and non-convergence are both possible.


\section{Convergence of Phase 2}
\label{sec:convergencePhase2}
For shorter notation, set 
$$
\Qb{m}:=\Q_{[\underbrace{\scriptstyle b,\dots,b}_m]}
$$ for $m \in \NN$ and $b\in\B$.

Obviously, finiteness of Phase~2 implies that there exists a length of window $M$ such that the set $\Qb{m}$ contains only one element for all $b\in\B$. 
The following theorem is used for the construction of Algorithm \ref{alg:oneletterSets} which checks this necessary condition. 

\begin{theo}
\label{thm:stoppingCondition}
Let $m_0 \in \NN$ and $b\in\B$ be such that sets $\Qb{m_0}$ and $\Qb{m_0-1}$ produced by deterministic Algorithm \ref{alg:minimalSet} within Phase~2 have the same size. Then
$$
    \#\Qb{m} = \#\Qb{m_0} \qquad \forall m\geq m_0-1\,.
$$ 
Particularly, if $\#\Qb{m_0}\geq 2$, Phase~2 does not converge.
\end{theo}
\begin{proof}
We prove the base case of induction with respect to $m$. For $m=m_0+1$, the set $\Qb{m_0+1}$ is found by Algorithm \ref{alg:minimalSet} such that 
$$
b + \Qb{m_0} \subset \A + \beta \Qb{m_0+1}\,
$$
and set $\Qb{m_0}$ is found by the same algorithm such that
$$
b + \Qb{m_0-1} \subset \A + \beta \Qb{m_0}\,.
$$
As $\Qb{m_0} \subset \Qb{m_0-1}$, the assumption of the same size implies
$$
    \Qb{m_0} = \Qb{m_0-1}\,.
$$
It means that Algorithm \ref{alg:minimalSet} runs with the same input and hence
$$
\Qb{m_0+1}=\Qb{m_0}\,.
$$
The inductive step of the proof for $m+1$ is analogous to the base case.

Phase 2 ends when there is only one element in $\Q_{[w_j,\dots, w_{j-m+1}]}$ for all $(w_j,\dots, w_{j-m+1}) \in \B^m$ for some fixed length of window $m$. But if $\#\Qb{m_0}\geq 2$, size of $\Q_{[b,\dots,b]}$ does not decrease despite of extending the length of window.
\end{proof}

 Now we describe Algorithm \ref{alg:oneletterSets} which checks whether Phase~2 stops when it processes input digits $bb\dots b$.
For arbitrary $m$, sets $\Qb{m}$  can be easily constructed separately for each $b\in\B$. We build the set $\Qb{m}$ for input digits $bb\dots b$ in the same way as in Phase 2. This means that we first search for $\Qb{}$ such that 
$$
b + \Q \subset \A + \beta \Qb{}\,.
$$
Until the set $\Qb{m}$ contains only one element, we increment the length of  window $m$ and, using Algorithm \ref{alg:minimalSet}, we build the subset $\Qb{m+1}$ of the set $\Qb{m}$ such that
$$
b + \Qb{m} \subset \A + \beta \Qb{m+1}\,.
$$
In addition, we check whether the set $\Qb{m+1}$ is strictly smaller than the set $\Qb{m}$. If not, we know by Theorem \ref{thm:stoppingCondition} that Phase 2 does not converge because of the input digits $bb\dots b$.

Thus, running of Algorithm \ref{alg:oneletterSets} for each input digit $b\in\B$ can reveal non-finiteness of Phase~2.

\begin{algorithm}
  \caption{Check input $bb\dots b$}
    \label{alg:oneletterSets}
  \begin{algorithmic}[1]
    \REQUIRE{Weight coefficient set $\Q$, digit $b\in\B$}
    \STATE $m:=1$
    \STATE Find minimal set $\Qb{1} \subset \Q$ such that
      $$
      b + \Q \subset \A + \beta \Qb{1}\,.
      $$
      \vspace{-20pt}
    \WHILE{$\#\Qb{m} > 1$}
        \STATE $m:= m +1$
        \STATE By Algorithm \ref{alg:minimalSet}, find minimal set $\Qb{m} \subset \Qb{m-1}$ such that
          $$
          b + \Qb{m-1} \subset \A + \beta \Qb{m}\,.
          $$  
          \vspace{-20pt}
        \IF{$\#\Qb{m}=\#\Qb{m-1}$}
            \RETURN Phase 2 does not converge for input $bb\dots b$.
        \ENDIF
    \ENDWHILE  
    \RETURN Weight coefficient for input $bb\dots b$ is the only element of $\Qb{m}$.
  \end{algorithmic}
\end{algorithm}


\section{Alphabet}
\label{sec:alphabet}
We see from Algorithm \ref{alg:searchCand} that there have to be all representatives modulo $\beta$ to ensure that we always find all needed candidates. It can be seen also from the proof of Theorem \ref{thm:suffCondPhase1}. 

We divide the elements of the alphabet $\A$ into the congruence classes mod $\beta$. The number of congruence classes mod $\beta$ is given by $|\text{det} S_\beta|$ where $S_\beta$ is the companion matrix of the minimal polynomial of $\beta$, see for instance the paper of A. Kov\'acs \cite{kovacs}. Therefore, it can be checked whether we have representative from all congruence classes.


The existence of a parallel digit set conversion implies also the following condition on the alphabet $\A$.   
\begin{theo}
Let $\omega$ be an algebraic integer. Let the base $\beta\in\Zomega$ be such that $|\beta|>1$ and the alphabet $\A\subset\Zomega$ be such that $0\in\A$. If there exists a $p$-local digit set conversion defined by the function $\phi\colon (\A+\A)^p\rightarrow \A$, the number $\phi(b,\dots,b)-b$ belongs to the set $(\beta-1)\Zomega$ for any $b\in\A+\A$. 
\end{theo}
The proof can be found in \cite{minAlph}. Nevertheless, it is easy to prove for the digit set conversion which is constructed by the rewriting rule $x-\beta$. Take the formula \eqref{eq:localConversion} with the input $b,\dots,b$:
$$
    \phi(b, \dots, b)=b+ \underbrace{q(b, \dots, b)}_{=:q'} - \beta q(b, \dots, b)\,.
$$
Hence
$$
\phi(b, \dots, b)-b=-q'(\beta-1)\,
$$
for $q'\in\Zomega$.

Thus, the representatives mod $\beta-1$ of all elements of the input alphabet $\B\subset\A+\A$ must be contained in the alphabet $\A$. 

To verify this for $b\in\B$, we iterate through the alphabet $\A$ and search for $a\in\A$ such that $b-a$ is divisible by $\beta-1$.

