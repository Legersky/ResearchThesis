\section{Basic formula for digit set conversion}
The general concept of addition (standard or parallel) in any numeration system $(\beta,\A)$, such that $\fin{\A}$ is closed under addition, is following: we add numbers digitwise and then we convert the result into the alphabet $\A$. Obviously, digitwise addition is computable in parallel, thus the crucial point is the conversion of the obtained result. It can be easily done in a standard way but a parallel digit set conversion is nontrivial. However, formulas are basically same but the choice of coefficients differs.

Now we go step by step more precisely. Let $x=\sum_{-m'}^{n'} x_i\beta^i,y=\sum_{-m'}^{n'} y_i\beta^i \in \fin{\A}$ with $(\beta,\A)$-representantions padded by zeros to have the same length. We set 
  \begin{align*}
    w&=x+y =\sum_{-m'}^{n'} x_i\beta^i + \sum_{-m'}^{n'} y_i\beta^i = \sum_{-m'}^{n'} (x_i+y_i)\beta^i \\
    &=\sum_{-m'}^{n'} w_i\beta^i \,,
  \end{align*}
  where $w_j=x_j+y_j \in \A +\A$. Thus, $w_{n'} w_{{n'}-1}\cdots w_1 w_0 \bullet w_{-1} w_{-2} \cdots w_{-m'}$ is a  $(\beta, \A+\A)$-representation of $w\in \fin{\A+\A}$. 

We also use column notation of addition in the following, e.g.,     
  \begin{align*}
  x_{n'} \;x_{{n'}-1}\cdots x_1 \;x_0 &\bullet x_{-1} \;x_{-2}\, \cdots x_{-m'} \\[-3pt]
  y_{n'} \;y_{{n'}-1}\cdots y_1 \,\;y_0 &\bullet y_{-1} \;y_{-2} \;\cdots y_{-m'} \\[-7pt]
    \line(1,0){90} & \line(1,0){100} \\[-7pt]
  w_{n'} w_{{n'}-1}\cdots w_1 w_0 &\bullet w_{-1} w_{-2} \cdots w_{-m'}\,.
  \end{align*}
  
As we want to obtain a $(\beta,\A)$-representation of $w$, we search a sequence 
  $$z_{n} z_{n-1}\cdots z_1 z_0 z_{-1} z_{-2} \cdots z_{-m}$$ such that $z_j \in \A$ and
  $$
    z_{n} z_{n-1}\cdots z_1 z_0 \bullet z_{-1} z_{-2} \cdots z_{-m}=(w)_{\beta,\A}\,.
  $$
  In the next, we consider without lost of generality only $\beta$-integers since modification for representations with rational part is obvious:
  $$
  \beta^m \cdot z_{n} z_{n-1}\cdots z_1 z_0 \bullet z_{-1} z_{-2} \cdots z_{-m} = z_{n} z_{n-1}\cdots z_1 z_0 z_{-1} z_{-2} \cdots z_{-m} \bullet
  $$  
  Particulary, let $(w)_{\beta, \A+\A}=w_{n'} w_{{n'}-1}\cdots w_1 w_0 \bullet$. We search $n \in \NN$ and $z_{n}, z_{n-1},\dots, z_1, z_0 \in \A$ such that $(w)_{\beta, \A}=z_{n} z_{n-1}\cdots z_1 z_0 \bullet$.   
  
  We use suitable representation of zero to convert digits $w_j$ into the alphabet $\A$. 
  \begin{defn}
  For a base $\beta \in \Zomega$, a polynomial $R(x)=r_s x^s+r_{s-1}x^{s-1}+ \dots + r_1 x+r_0$ with coefficients $r_i \in \Zomega,$ such that $R(\beta)=0$, is called a \emph{rewriting rule}. MA TAM BYT Z[OMEGA] NEBO Z[BETA]???
  \end{defn}  
  
  An arbitrary rewriting rule may be used for conversion, then so called \emph{core coefficient}, i.e., one of the coefficients which is greatest in modulus, is applied to convert a digit $w_j$. For our purpose, we use the simplest possible rewriting rule
  $$
    R(x)=x-\beta \in \Zomega[x]\,.
  $$
As $0=\beta^{j} \cdot R(\beta)=1\cdot \beta^{j+1} -\beta \cdot \beta^{j}$, we have a representation of zero 
$$1 (-\!\beta) \underbrace{0 \cdots 0}_{j}\bullet = (0)_\beta\,. $$
for all $j \in \NN$. We multiply this representation by $q_j \in \Zomega$ which is called a \emph{weight coefficient} to obtain representation of zero 
$$q_j (-q_j\beta) \underbrace{0 \cdots 0}_{j}\bullet = (0)_\beta\,. $$ 
This is digitwise added to $w_{n} w_{n-1}\cdots w_1 w_0 \bullet$ to convert the digit $w_j$ into the alphabet $\A$. This causes that there is a \emph{carry} $q_{j}$ on the $(j+1)$-th position from the conversion of $j$-th digit. The procedure runs from right ($j=0$) to right until all digits and carries are converted into the alphabet $\A$:
    \begin{align*}
        w_n w_{n-1}&&&\cdots& &w_{j+1}&\!\! &\textcolor{red}{w_j}  & \!\!  &w_{j-1} &&\cdots &&w_1 w_0\bullet \hspace{200pt}\\[-5pt]
                   &&&&       &       & &     &   &q_{j-2} &&\iddots\\[-3pt] 
                   &&&&       &       & &\textcolor{red}{q_{j-1}}& -&\beta q_{j-1} \\[-3pt]
                   &&&&         &q_j&   \textcolor{red}{-}&\textcolor{red}{\beta q_j} &&\\[-8pt]
                   &&&  \iddots      &   -&\beta q_{j+1}&   &\ &&\\[-17pt]
    \intertext{\line(1,0){280}}
    \vspace{-15pt}
    \\[-30pt]
     z_{n+s} \cdots z_{n} z_{n-1}&&&\cdots& &z_{j+1}& &\textcolor{red}{z_j}& &z_{j-1} &&\cdots &&z_1 \; z_0\bullet                            
    \end{align*}
    Hence, the desired formula for conversion on the $j$-th position is 
    \begin{equation}
        z_j=w_j + q_{j-1} - q_j \beta
    \end{equation}
    for $j \in \NN_0$ having set $q_{-1}=0$ as there is no carry from the right on the 0-th position.
    
     Clearly, the value of $w$ is preserved:
\begin{align*}
    \sum_{j\geq 0} z_j \beta^j &=w_0 - \beta q_0 + \sum_{j> 0} (w_j + q_{j-1} - q_j \beta) \beta^j \\
    &=\sum_{j\geq 0} w_j \beta^j + \sum_{j>0} q_{j-1} \beta^j - \sum_{j\geq 0} q_j \cdot \beta^{j+1} \\
    &=\sum_{j\geq 0} w_j \beta^j + \sum_{j>0} q_{j-1} \beta^j - \sum_{j> 0} q_{j-1} \cdot \beta^j \\
    &=\sum_{j\geq 0} w_j \beta^j = w\,.
\end{align*}

     The weight coefficient $q_j$ must be chosen such that the converted digit is in the alphabet~$\A$, i.e., 
    \begin{equation}
    \label{eq:conversionFormula}
        z_j=w_j + q_{j-1} - q_j \beta \in \A\,.
    \end{equation}
    Choice of weight coefficients is the crucial part in the case of construction of parallel addition algorithms. Our method determining weight coefficients for a given input is decribed in Section~\ref{sec:methodDescription}.
    
     On the other hand, it is trivial for standard numeration systems.  Notice that
    $$
        z_j \equiv w_j+q_{j-1} \mod \beta\,. 
    $$
  Assume now a standard numeration system $(\beta, \A)$, where
  $$
    \beta \in \NN\,,\beta  \geq 2\,, \A = \{0, 1, 2,\dots, \beta -1 \}\,.
  $$ 
  There is only one representative of each class modulo  $\beta$. Therefore, the digit $z_j$ is uniquely determined for a given digit $w_j \in \A+\A$ and carry $q_{j-1}$ and thus so is the weight coefficient $q_j$. This means that $q_j=q_j(w_j,q_{j-1})$ for all $j\geq 0$. Generally,
  $$
  z_j=z_j(w_j ,\dots , w_1, w_0)\,,
  $$
  which implies that addition runs in linear time.
  
  We want to the digit set conversion from $\A+\A$ into $\A$ be computable in parallel, i.e., there exist constants $r,t \in \NN_0$ such that for all $j\geq 0$ is $z_j=z_j(w_{j+r},\dots,w_{j-t})$. To avoid the dependency on all less, respectivelly more, significant digits, we need variety in the choice of weight coefficient $q_j$. This implies that the used numeration system must be redundant.
  
  
  
  NEJAKE LEMMA O TOM, ZE NEREDUNDANTNI SYSTEM VEDE NA LINEARNI CAS???


\section{Method}
In order to construct a parallel digit set conversion in numeration system $(\beta,\A)$ we consider more general case of conversion from an \emph{input alphabet} $\B$ such that $\A \subsetneq \B \subset \A +\A$ instead of the alphabet $\A+\A$.
As menshioned above, the key problem is to find for every $j\geq 0$ a weight coefficient $q_j$ such that 
    $$
        z_j=\underbrace{w_j}_{\in \B} + q_{j-1} - q_j \beta \in \A 
    $$  
    for any input $w\in \fin{\B}, (w)_{\beta,\B}=w_{n'}w_{n'-1}\dots w_1 w_0 \bullet$. We remark that the weight coefficient $q_{j-1}$ is determined by the input $w$. For digit set conversion to be computable in parallel we demand to digit $z_j=z_j(w_{j+r},\dots,w_{j-t})$ for a fixed anticipation $r$ and memory $t$ in $\NN_0$.
    
    We introduce following definitions to obtain the desired digit set conversion. 
    \begin{defn}
        Let $\B$ be a set such that $\A \subsetneq \B \subset \A +\A$. Then any set $\Q\subset\Zomega$ containing~0 such that 
        $$
            \B + \Q \subset \A + \beta \Q
        $$  
        is called a \emph{set of weight coefficients}.
    \end{defn}
    We see that
        $$
        (\forall w_j \in \B)(\forall q_{j-1}\in\Q)(\exists q_j \in \Q )(w_j + q_{j-1} - q_j \beta \in \A )\,.
        $$
    Accordingly, there is a weight coefficient $q_j \in \Q$ for any carry from the right $q_{j-1}\in \Q$ and any digit $w_j$ in the input alphabet $\B$. I.e., we  satisfy basic conversion formula (\ref{eq:conversionFormula}). Notice that $q_{-1}=0$ is in $\Q$ by definition. Thus, all weight coeficients may be chosen from $\Q$ inductively.
    \begin{defn}
    Let $M$ be an integer and $q:\B^{M} \rightarrow \Q$ be a mapping such that 
    $$
    w_j+ q(w_{j-1}, \dots, w_{j-M}) - \beta q(w_j, \dots, w_{j-M+1}) \in \A
    $$
    for all $w_j,w_{j-1}, \dots, w_{j-M} \in \B$. Then $q$ is called a \emph{weight function} and $M$ is called a \emph{length of window}.    
    \end{defn}
 
 JE TREBA POZADOVAT q(0,...,0)=0 NEBO TO Z NECEHO PLYNE?

 Having a weight function $q$, we define a function $\phi:\B^{M+1}\rightarrow \A$ by
    $$
        \phi(w_{j}, \dots, w_{j-M})=w_j+ \underbrace{q(w_{j-1}, \dots, w_{j-M})}_{=q_{j-1}} - \beta \underbrace{q(w_j, \dots, w_{j-M+1})}_{=q_j}=:z_j\,,
    $$ 
    which verifies that the conversion is indeed $(M+1)$-local function with anticipation $r=0$ and memory $t=M$.
    
The construction of a parallel conversion algorithm by so-called \emph{extending window method} consists of two phases:
    \begin{enumerate}
        \item Find minimal possible weight coefficient set $\Q$.
        \item Increment expected length of window $M$ and for each $(w_j,w_{j-1}, \dots , w_{j-M+1}) \in \B^{M}$ try to find a weight coefficient from $\Q$ to define $q$.
    \end{enumerate}
    
\subsection{Phase 1 -- Weight coefficient set}

    We build $\Q$ iteratively:
    
    
    {Phase 1}
     $k:=0$
     
      Set $\Q_0:=\{0\}$
      
      
      Repeat:
      \begin{itemize}
          \item extend $\Q_k$ to $\textcolor{red}{\Q_{k+1}}$ in a minimal possible way so that
           $$
              (\A+\A)+ \Q_k \subset \A + \beta \textcolor{red}{\Q_{k+1}}\,,
           $$
           \item $k:=k+1$
      \end{itemize}
      
      until $\Q_k = \Q_{k+1}$.
      
      
      \vspace{7pt}
      $\Q:=\Q_k$
    





\subsection{Phase 2 -- Weight function}

    {Phase 2 -- searching for a weight function}

    We want to find a length of the window $M$ and a weight function $q:(\A+\A)^{M} \to \Q$.% have $q_j=q(w_j,w_{j-1},\dots, w_{j-M+1})$, where $q$ is a weight function:
%     \begin{align*}
%         \cdots\; &w_{j+1}&\!\! &\textcolor{red}{w_j}  & \!\!  &\textcolor{red}{w_{j-1}\cdots w_{j-M+1}} w_{j-M} \cdots\\[-3pt]
%                          & &       &q_{j-1}& -&\beta q_{j-1} \\[-1pt]
%                            &q_j&   -&\beta \textcolor{red}{q_j} &&\\[-19pt]      
%     \intertext{\line(1,0){280}}
%     \\[-30pt]
%      \cdots\; &z_{j+1}& &z_j& &z_{j-1} \cdots z_{j-M+1}\; z_{j-M}\cdots                     
%     \end{align*}
    
    
    Suppose that the length of the window is $m$.
    
    The idea is to check all possible right carries $q_{j-1}$ and determine values $q_j$ such that 
    $$
    z_j=w_j + q_{j-1} - q_j \beta \in \A \,.
    $$
    The set of all such needed values of $q_j$ is denoted by $\Q_{[w_{j},\dots, w_{j-m+1}]}\subset \Q$
        
    
    The length $M$ and weight function $q$ is found when 
    $$
    \#\Q_{[w_{j},\dots, w_{j-M+1}]}=1
    $$
    for all $w_{j},\dots, w_{j-M+1} \in (\A+\A)^M$.
%     \begin{equation*}
%     w_j + \underbrace{q(w_{j-1},w_{j-2},\dots, w_{j-M})}_{\in \Q_{[w_{j-1},w_{j-2},\dots, w_{j-M}]}  \subset \Q }=z_j + \beta \cdot \underbrace{q(w_j,w_{j-1},\dots, w_{j-M+1})}_{\in \Q_{[w_j,w_{j-1},\dots, w_{j-M+1}]} \subset \Q}
%     \end{equation*}
    



    {Phase 2}
      $m:=1$
      
      For each $w_j \in \A+\A$ find minimal set $\Q_{[w_j]} \subset \Q$ such that
      $$
      w_j + \Q \subset \A + \beta \Q_{[w_j]}
      $$
    
      While $(\max\{\#\Q_{[w_j,\dots, w_{j-m+1}]}:(w_j,\dots, w_{j-m+1}) \in (\A+\A)^m \} > 1)$ do:
      \begin{itemize}
          
          \item $m:= m +1$
          
          \item For each $(w_j,\dots, w_{j-m+1}) \in (\A+\A)^{m}$ find minimal set $\textcolor{red}{\Q_{[w_j,\dots, w_{j-m+1}]}} \subset \Q_{[w_j,\dots, w_{j-m+2}]}$ such that
          $$
          w_j + \Q_{[w_{j-1},\dots, w_{j-m+1}]} \subset \A + \beta \textcolor{red}{\Q_{[w_j,\dots, w_{j-m+1}]}}\,,
          $$
      \end{itemize}
      
      $M:= m$ 
      
      
      $q(w_j,\dots, w_{j-M+1}):=$ only element of $\Q_{[w_j,\dots, w_{j-M+1}]}$
    



        Now we have parallel conversion algorithm:
    \begin{align*}
    z_j&=w_j + q_{j-1} - q_j \beta = \\
       &=w_j + q(w_{j-1},w_{j-2},\dots, w_{j-M}) - \beta q(w_j,w_{j-1},\dots, w_{j-M+1}) = \\
       &= z_j(w_{j},w_{j-1},\dots, w_{j-M})\,.
    \end{align*}




